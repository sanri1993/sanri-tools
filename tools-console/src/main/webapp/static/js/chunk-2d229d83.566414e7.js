(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d229d83"],{ded0:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-row",[a("el-col",[a("el-button",{staticClass:"margin-right",attrs:{type:"text",icon:"el-icon-refresh"},on:{click:e.reloadAllConnects}}),a("el-select",{attrs:{size:"small"},on:{change:e.refreshZookeeperTree},model:{value:e.input.connect,callback:function(t){e.$set(e.input,"connect",t)},expression:"input.connect"}},e._l(e.connects,(function(e){return a("el-option",{key:e,attrs:{value:e,label:e}})})),1),a("el-button",{attrs:{size:"small",plain:""},on:{click:e.addFavorite}},[e._v("添加收藏")]),a("span",e._l(e.favorites,(function(t){return a("el-tag",{key:t.name,staticClass:"cursor-point margin-left",attrs:{type:"info",closable:""},on:{click:function(a){return e.openPath(t)},close:function(a){return e.deleteFavorite(t)}}},[e._v(e._s(t.name))])})),1)],1)],1),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-tree",{ref:"nodeTree",attrs:{lazy:"",load:e.loadNode,"node-key":"xpath",props:e.view.treeProps,"highlight-current":!0,"show-checkbox":!1,"expand-on-click-node":!1,"default-expanded-keys":e.view.treeConfig.expandedKeys},on:{"node-click":e.clickTreeNode}})],1),a("el-col",{attrs:{span:16}},[a("p",[e._v("xpath: "+e._s(e.unescape(e.input.xpath)))]),a("el-tabs",{on:{"tab-click":e.switchTab},model:{value:e.view.activeTabName,callback:function(t){e.$set(e.view,"activeTabName",t)},expression:"view.activeTabName"}},[a("el-tab-pane",{attrs:{label:"节点数据",name:"first"}},[e._v(" "+e._s(e.nodeData)+" ")]),a("el-tab-pane",{attrs:{label:"节点属性",name:"second"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.meta,border:"",stripe:"",size:"mini"}},[a("el-table-column",{attrs:{prop:"key",label:"属性名",width:"180"}}),a("el-table-column",{attrs:{prop:"value",label:"属性值",width:"180"}}),a("el-table-column",{attrs:{prop:"remark",label:"备注"}})],1)],1),a("el-tab-pane",{attrs:{label:"节点 ACL",name:"third"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.acls,border:"",stripe:"",size:"mini"}},[a("el-table-column",{attrs:{prop:"schema",label:"schema",width:"60"}}),a("el-table-column",{attrs:{prop:"id",label:"id",width:"80"}}),a("el-table-column",{attrs:{prop:"perms",label:"perms",width:"40"}}),a("el-table-column",{attrs:{prop:"permsString",label:"权限列表"}})],1)],1)],1)],1)],1)],1)},r=[],o=(a("b0c0"),a("c740"),a("a434"),a("a15b"),a("ac1f"),a("1276"),a("d81d"),a("b775")),i=a("4328"),c=a.n(i),s={childrens:function(e,t){return o["a"].get("/zookeeper/childrens",{params:{connName:e,path:t}})},meta:function(e,t){return o["a"].get("/zookeeper/meta",{params:{connName:e,path:t}})},acls:function(e,t){return o["a"].get("/zookeeper/acls",{params:{connName:e,path:t}})},readData:function(e,t){return o["a"].get("/zookeeper/readData",{params:{connName:e,path:t}})},favorites:function(e){return o["a"].get("/zookeeper/favorites",{params:{connName:e}})},addFavorite:function(e,t,a){return o["a"].post("/zookeeper/addFavorite",c.a.stringify({connName:e,name:t,path:a}))},removeFavorite:function(e,t){return o["a"].post("/zookeeper/removeFavorite",c.a.stringify({connName:e,name:t}))}},l=a("b1a9"),p={name:"zookeeper",data:function(){return{input:{connect:null,xpath:null},view:{treeProps:{children:"children",label:"label"},treeConfig:{expandedKeys:[]},activeTabName:"second"},connects:[],meta:[],acls:[],nodeData:null,favorites:[]}},mounted:function(){this.reloadAllConnects()},methods:{reloadAllConnects:function(){var e=this;l["a"].security.moduleConnectNames("zookeeper").then((function(t){e.connects=t.data,e.connects&&e.connects.length>0&&e.refreshZookeeperTree(e.connects[0])}))},unescape:function(e){return window.unescape(e)},deleteFavorite:function(e){var t=this;s.removeFavorite(this.input.connect,e.name).then((function(a){var n=t.favorites.findIndex((function(t){return t.name===e.name}));t.favorites.splice(n,1)}))},addFavorite:function(){var e=this,t=this.$refs.nodeTree.getCurrentNode();if(null!==t){var a=this.$refs.nodeTree.getNode(t);this.$prompt("取一个好记的名称","提示",{confirmButtonText:"确定"}).then((function(t){var n=t.value;s.addFavorite(e.input.connect,n,a.data.xpath).then((function(t){e.$message("添加收藏成功"),e.favorites.push({name:n,path:a.data.xpath})}))})).catch((function(e){}))}else this.$message({type:"error",message:"添加收藏失败,没有选中节点"})},switchTab:function(e,t){},clickTreeNode:function(e,t,a){var n=this;this.input.xpath=e.xpath,s.readData(this.input.connect,e.xpath).then((function(e){n.nodeData=e.data})),s.acls(this.input.connect,e.xpath).then((function(e){var t=e.data;n.acls.length=0;for(var a=0;a<t.length;a++){var r=t[a];r.permsString=r.permsParser.join("\t"),n.acls.push(r)}})),s.meta(this.input.connect,e.xpath).then((function(e){var t=e.data;for(var a in n.meta.length=0,t){var r={key:a,value:t[a]};switch(a){case"version":r["remark"]="数据版本";break;case"cversion":r["remark"]="子节点版本";break;case"aversion":r["remark"]="ACL 版本";break;case"dataLength":r["remark"]="数据长度";break;case"ctime":r["remark"]="节点创建时间";break;case"mtime":r["remark"]="节点最后一次被修改的时间";break;case"numChildren":r["remark"]="子节点个数";break;case"emphemeralOwner":r["remark"]="节点拥有者会话ID";break}n.meta.push(r)}}))},openPath:function(e){var t=this,a=e.path.split("/");if(!(a.length<3))for(var n=function(e){for(var n="",r=0;r<=e;r++)n+="/"+a[r];n=n.substring(1),t.view.treeConfig.expandedKeys.push(n),setTimeout((function(e){t.$refs.nodeTree.setCurrentKey(n);var a=t.$refs.nodeTree.getNode(n);t.clickTreeNode(a.data,a,null)}),500)},r=1;r<a.length;r++)n(r)},refreshZookeeperTree:function(e){var t=this;this.input.connect=e;var a=this.$refs.nodeTree.getNode("/");a.loaded=!1,a.expand(),s.favorites(this.input.connect).then((function(e){t.favorites=e.data}))},loadNode:function(e,t){if(0===e.level){var a=[{name:"/",label:"/",xpath:"/"}];return t(a)}var n=e.data.xpath;s.childrens(this.input.connect,n).then((function(e){"/"===n&&(n="");var a=e.data.map((function(e){return{name:e,label:unescape(e),xpath:n+"/"+e}}));return t(a)}))}}},u=p,d=a("2877"),h=Object(d["a"])(u,n,r,!1,null,null,null);t["default"]=h.exports}}]);