(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7008d3de"],{5342:function(t,e,o){},5705:function(t,e,o){"use strict";o("5342")},b076:function(t,e,o){"use strict";o.r(e);var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"app-container"},[o("el-alert",{staticClass:"margin-bottom",attrs:{type:"success",closable:!1}},[o("template",{slot:"title"},[t._v(" 如果需要使用 ssh 认证, 请 "),o("el-button",{attrs:{type:"text"},on:{click:t.downloadPublicKey}},[t._v("下载 publicKey")]),t._v(" 并传到对应应用 ")],1)],2),o("el-row",[o("el-col",{attrs:{span:5}},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.modules,border:"",stripe:"","highlight-current-row":"",size:"mini"}},[o("el-table-column",{attrs:{prop:"name",label:"模块"}}),o("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.loadModuleConnects(e.row.name)}}},[t._v("查看连接")])]}}])})],1)],1),o("el-col",{staticClass:"margin-left",attrs:{span:18}},[o("el-button",{staticClass:"margin-bottom",attrs:{size:"small",type:"primary"},on:{click:t.preCreateConnect}},[t._v("新建 "+t._s(t.choseModule)+" 连接")]),o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.moduleConnects,border:"",stripe:"",size:"mini"}},[o("el-table-column",{attrs:{type:"index",width:"55"}}),o("el-table-column",{attrs:{prop:"connectInput.baseName",label:"基础名",width:"150",sortable:""}}),o("el-table-column",{attrs:{prop:"path",label:"路径",width:"210"}}),o("el-table-column",{attrs:{prop:"connectInput.configTypeName",label:"配置格式",width:"70"}}),o("el-table-column",{attrs:{prop:"lastUpdateTime",label:"最后更新时间",width:"180"}}),o("el-table-column",{attrs:{prop:"lastAccessTime",label:"最后访问时间",width:"180"}}),o("el-table-column",{attrs:{prop:"lastUpdateUser",label:"更新人"}}),o("el-table-column",{attrs:{prop:"connectInput.group",label:"组织"}}),o("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.readConnect(e.row.connectInput)}}},[t._v("详情")]),o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.delConnects(e.row.connectInput.baseName)}}},[t._v("删除")])]}}])})],1)],1)],1),o("el-dialog",{attrs:{visible:t.dialog.add.visible,title:t.dialog.add.title},on:{"update:visible":function(e){return t.$set(t.dialog.add,"visible",e)}}},[o("el-form",{ref:"addConnectForm",attrs:{size:"mini","label-position":"right","label-width":"120px",model:t.dialog.add.connectInput,rules:t.dialog.add.rules}},[o("el-form-item",{attrs:{label:"模块名",prop:"module"}},[o("el-input",{attrs:{placeholder:"模块名",readonly:"",size:"small"},model:{value:t.dialog.add.connectInput.module,callback:function(e){t.$set(t.dialog.add.connectInput,"module",e)},expression:"dialog.add.connectInput.module"}})],1),o("el-form-item",{attrs:{label:"基础名",prop:"baseName"}},[o("el-input",{attrs:{placeholder:"基础名",size:"small"},model:{value:t.dialog.add.connectInput.baseName,callback:function(e){t.$set(t.dialog.add.connectInput,"baseName",e)},expression:"dialog.add.connectInput.baseName"}})],1),o("el-form-item",{attrs:{label:"配置文件格式",prop:"configTypeName"}},[o("el-input",{attrs:{placeholder:"配置文件格式",readonly:"",size:"small"},model:{value:t.dialog.add.connectInput.configTypeName,callback:function(e){t.$set(t.dialog.add.connectInput,"configTypeName",e)},expression:"dialog.add.connectInput.configTypeName"}})],1),o("el-row",[o("el-col",{attrs:{span:7}},[t.dialog.add.accessGroups?o("div",{staticStyle:{height:"300px","overflow-y":"scroll"}},[o("el-tree",{ref:"groupTree",attrs:{data:t.dialog.add.accessGroups,"check-strictly":!0,"node-key":"path","default-expanded-keys":["/"],props:{label:"path"},"show-checkbox":""}})],1):t._e()]),o("el-col",{attrs:{span:16}},[o("monaco-editor",{ref:"addEditor",attrs:{language:t.dialog.add.connectInput.configTypeName,code:t.dialog.add.connectInput.content}})],1)],1)],1),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{staticClass:"margin-bottom",attrs:{type:"primary",size:"small"},on:{click:t.writeConfig}},[t._v("确定")])],1)],1),o("el-dialog",{attrs:{visible:t.dialog.editcontent.visible,width:"80%",title:t.dialog.editcontent.title},on:{"update:visible":function(e){return t.$set(t.dialog.editcontent,"visible",e)}}},[o("monaco-editor",{ref:"modifyEditor",attrs:{language:t.dialog.editcontent.connectInput.configTypeName,code:t.dialog.editcontent.content}}),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{staticClass:"margin-bottom margin-left",attrs:{type:"primary",size:"small"},on:{click:t.updateContent}},[t._v("保存")])],1)],1)],1)},a=[],l=o("5530"),i=(o("d81d"),o("b0c0"),o("b1a9")),d=o("b0eb"),s=o("2f62"),c=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{ref:"editorContainer",staticClass:"editor"})},r=[],u=o("c2c6"),p={name:"MonacoEditor",props:{language:{type:String,default:"json"},code:{type:String,default:null}},data:function(){return{editor:null}},mounted:function(){this.init()},methods:{init:function(){console.log("初始化编辑器:"+this.language),this.editor=u["editor"].create(this.$refs.editorContainer,{value:this.code,theme:"vs-dark",language:this.language,tabSize:4,scrollBeyondLastLine:!1,automaticLayout:!0,readOnly:!1,selectOnLineNumbers:!0,roundedSelection:!1,cursorStyle:"line",glyphMargin:!0,useTabStops:!1,fontSize:18,autoIndent:!0,quickSuggestionsDelay:500}),this.code&&this.editor.setValue(this.code),this.editor.onDidChangeModelContent((function(t){})),this.editor.onDidBlurEditorText((function(t){}))},getValue:function(){return this.editor.getValue()},setValue:function(t){this.editor.setValue(t)},format:function(){this.editor.trigger("anything","editor.action.formatDocument")},changeEditor:function(){console.log("修改编辑器:"+this.language),null===this.editor&&this.init();var t=this.editor.getModel(),e=u["editor"].createModel(this.code,this.language);t&&t.dispose(),this.editor.setModel(e)}},watch:{code:{handler:function(t,e){this.editor.setValue(t)}},language:{handler:function(t,e){this.changeEditor()}}}},g=p,h=(o("5705"),o("2877")),m=Object(h["a"])(g,c,r,!1,null,"721bb906",null),f=m.exports,b={name:"connect",components:{MonacoEditor:f},data:function(){return{modules:[],choseModule:null,moduleConnects:[],dialog:{add:{title:"新建连接",visible:!1,randomkey:1,connectInput:{module:null,baseName:null,configTypeName:null,group:null,content:null},accessGroups:[],rules:{module:[{required:!0,message:"模块名必填",trigger:"blur"}],baseName:[{required:!0,message:"基础名必填",trigger:"blur"}],configTypeName:[{required:!0,message:"配置类型必填",trigger:"blur"}]}},editcontent:{title:"编辑连接内容",visible:!1,content:null,connectInput:{}}}}},mounted:function(){this.loadModules()},methods:{downloadPublicKey:function(){i["a"].downloadPublicKey()},delConnects:function(t){var e=this;i["a"].security.delConnect(this.choseModule,t).then((function(t){e.loadModuleConnects(e.choseModule)}))},loadModules:function(){var t=this;i["a"].security.modules().then((function(e){t.modules=e.data.map((function(t){return{name:t}})),t.modules&&t.modules.length>0&&(t.choseModule||t.loadModuleConnects(t.modules[0].name))}))},loadModuleConnects:function(t){var e=this;this.choseModule=t,i["a"].security.moduleConnects(t).then((function(t){e.moduleConnects=t.data}))},readConnect:function(t){var e=this;this.dialog.editcontent.title="编辑 "+this.choseModule+" [ "+t.baseName+" ]  连接内容",i["a"].security.loadContent(this.choseModule,t.baseName).then((function(o){e.dialog.editcontent.connectInput=t,e.dialog.editcontent.content=o.data,e.dialog.editcontent.visible=!0}))},preCreateConnect:function(){var t=this;this.dialog.add.connectInput.module=this.choseModule,this.dialog.add.visible=!0,this.dialog.add.title="新建 "+this.choseModule+" 连接",this.needSecurity?d["a"].accessGroups().then((function(e){t.dialog.add.accessGroups=[e.data]})):this.dialog.add.accessGroups=[{path:"/",children:[]}],i["a"].security.connectTemplate(this.choseModule).then((function(e){t.dialog.add.connectInput.configTypeName=e.data.configTypeName,t.dialog.add.connectInput.content=e.data.content,t.dialog.add.randomkey=Math.floor(0xe8d4a54019*Math.random())}))},writeConfig:function(){var t=this;this.$refs["addConnectForm"].validate((function(e){if(!e)return!1;var o=t.$refs.groupTree.getCheckedKeys();t.dialog.add.connectInput.content=t.$refs.addEditor.getValue(),0!==o.length?o.length>1?t.$confirm("只能选择一个节点做为连接分组,现将使用 "+o[0]+" 做为分组, 确定?","警告",{type:"warning"}).then((function(){t.dialog.add.connectInput.group=o[0],i["a"].security.writeConfig(t.dialog.add.connectInput).then((function(e){t.loadModuleConnects(t.choseModule),t.dialog.add.visible=!1}))})).catch((function(){})):(t.dialog.add.connectInput.group=o[0],i["a"].security.writeConfig(t.dialog.add.connectInput).then((function(e){t.loadModuleConnects(t.choseModule),t.dialog.add.visible=!1}))):t.$message("需要选择一个组织节点做为连接的组织以方便权限过滤")}))},updateContent:function(){var t=this;this.dialog.editcontent.content=this.$refs.modifyEditor.getValue();var e=Object.assign(this.dialog.editcontent.connectInput,{content:this.dialog.editcontent.content});i["a"].security.writeConfig(e).then((function(e){t.loadModuleConnects(t.choseModule),t.dialog.editcontent.visible=!1}))}},computed:Object(l["a"])({},Object(s["b"])(["needSecurity"]))},y=b,v=Object(h["a"])(y,n,a,!1,null,null,null);e["default"]=v.exports}}]);