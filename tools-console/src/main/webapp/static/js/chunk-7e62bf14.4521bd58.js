(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7e62bf14"],{2250:function(t,e,s){},"6c2f":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-row",[s("el-button",{staticClass:"margin-right",attrs:{type:"text",icon:"el-icon-refresh"},on:{click:t.refreshConnects}}),s("el-select",{attrs:{size:"small"},on:{change:t.choseConnect},model:{value:t.input.connect,callback:function(e){t.$set(t.input,"connect",e)},expression:"input.connect"}},t._l(t.connects,(function(t){return s("el-option",{key:t,attrs:{value:t,label:t}})})),1),s("span",{staticClass:"margin-left",style:"color:"+t.clusterModel.clusterHealth.status},[t._v(t._s(t.clusterModel.clusterHealth.cluster_name))])],1),s("el-tabs",{attrs:{"active-name":t.tabs.activeTabName},on:{"tab-click":t.switchTab}},[s("el-tab-pane",{attrs:{name:"dashboard",label:"监控总览(实时)"}},[s("el-row",{staticClass:"margin-top"},[s("span",{staticClass:"margin-right"},[t._v("节点数量: "),s("b",[t._v(t._s(t.clusterModel.clusterHealth.number_of_nodes))])]),s("span",{staticClass:"margin-right"},[t._v("数据节点数量: "),s("b",[t._v(t._s(t.clusterModel.clusterHealth.number_of_data_nodes))])]),s("span",{staticClass:"margin-right"},[t._v("分片数: "),s("b",[t._v(t._s(t.clusterModel.clusterHealth.active_shards))])]),s("span",{staticClass:"margin-right"},[t._v("未分配分片数: "),s("b",[t._v(t._s(t.clusterModel.clusterHealth.unassigned_shards))])]),s("span",{staticClass:"margin-right"},[t._v("主分片数: "),s("b",[t._v(t._s(t.clusterModel.clusterHealth.active_primary_shards))])])]),s("div",{staticClass:"panel panel-default margin-top"},[s("div",{staticClass:"panel-heading"},[t._v("节点信息")]),s("div",{staticClass:"panel-body"},[s("el-row",[s("el-col",{attrs:{span:14}},[s("el-table",{attrs:{data:t.nodes,border:"",stripe:"","highlight-current-row":"",size:"mini"}},[s("el-table-column",{attrs:{type:"index",width:"50"}}),s("el-table-column",{attrs:{prop:"id",label:"id",width:"200"}}),s("el-table-column",{attrs:{prop:"transport_address",label:"transport",width:"140",sortable:""}}),s("el-table-column",{attrs:{label:"roles",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.roles.join(",")))])]}}])}),s("el-table-column",{attrs:{prop:"version",label:"version",width:"80"}}),s("el-table-column",{attrs:{label:"磁盘",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return t.clusterModel.nodeStats.nodes&&t.clusterModel.nodeStats.nodes[e.row.id]?[s("span",[t._v(t._s(t.calcStorageUsePercent(e.row))+"%")])]:void 0}}],null,!0)}),s("el-table-column",{attrs:{label:"内存",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return t.clusterModel.nodeStats.nodes&&t.clusterModel.nodeStats.nodes[e.row.id]?[s("span",[t._v(t._s(t.calcJvmMemUsePercent(e.row))+"%")])]:void 0}}],null,!0)}),s("el-table-column",{attrs:{label:"http",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return t.clusterModel.nodeStats.nodes&&t.clusterModel.nodeStats.nodes[e.row.id]?[s("span",[t._v(t._s(t.calcHttpOpen(e.row)))])]:void 0}}],null,!0)}),s("el-table-column",{attrs:{fixed:"right",label:"操作",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){return t.closeNode(e.row)}}},[t._v("关停")])]}}])})],1)],1)],1)],1)])],1),s("el-tab-pane",{attrs:{name:"index",label:"索引查询"}},[s("el-row",[s("el-col",{attrs:{span:9}},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:t.indices,border:"",stripe:"","highlight-current-row":"",fit:"",height:"500",size:"mini"}},[s("el-table-column",{attrs:{type:"index",width:"50"}}),s("el-table-column",{attrs:{prop:"indexName",label:"indexName",width:"240",sortable:""}}),s("el-table-column",{attrs:{label:"docs",width:"100",sortable:"","sort-by":"docs.count"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",[t._v(t._s(e.row.docs.count)+"("+t._s(e.row.docs.deleted)+")")])]}}])}),s("el-table-column",{attrs:{prop:"store",label:"store",width:"80",formatter:t.formatSize,sortable:""}}),s("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{attrs:{type:"text",size:"small"},on:{click:function(s){return t.searchIndexDataEvent(e.row)}}},[t._v("数据")])]}}])})],1)],1),s("el-col",{staticClass:"margin-left",attrs:{span:14}},[t.tabs.index.settings.index?[s("el-row",[s("el-col",{attrs:{span:14}},[s("p",[t._v("搜索耗时: "+t._s(t.tabs.index.result.took/1e6)+" ms")]),s("p",[t._v("索引信息: "+t._s(t.tabs.index.input.indexName))]),s("p",[t._v("创建时间: "+t._s(t.parseTime(t.tabs.index.settings.index.creation_date)))]),s("p",[t._v("分片数: "+t._s(t.tabs.index.settings.index.number_of_shards)+" 副本数: "+t._s(t.tabs.index.settings.index.number_of_replicas))]),s("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tabs.index.shardAlloc,border:"",stripe:"","highlight-current-row":"",fit:"",size:"mini"}},[s("el-table-column",{attrs:{type:"index",width:"50"}}),s("el-table-column",{attrs:{label:"分片主机",prop:"host",sortable:""}}),s("el-table-column",{attrs:{label:"分片信息"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.shards,(function(e){return s("el-button",{key:e,attrs:{type:"text"}},[e.primary?s("span",[s("b",[t._v(t._s(e.shard))])]):s("span",[t._v(" "+t._s(e.shard))])])}))}}],null,!1,1445985192)})],1)],1),s("el-col",{attrs:{span:10}},[s("vue-json-editor",{attrs:{"show-btns":!1,lang:"zh"},model:{value:t.tabs.index.mappings,callback:function(e){t.$set(t.tabs.index,"mappings",e)},expression:"tabs.index.mappings"}})],1)],1)]:t._e()],2)],1),s("el-row",{directives:[{name:"show",rawName:"v-show",value:t.tabs.index.result.hits.hits&&t.tabs.index.result.hits.hits.length>0,expression:"tabs.index.result.hits.hits && tabs.index.result.hits.hits.length > 0"}]},[s("el-pagination",{attrs:{"current-page":t.tabs.index.input.dsl.from,"page-size":t.tabs.index.input.dsl.size,layout:"total, sizes, prev, pager, next",total:t.tabs.index.result.hits.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),s("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tabs.index.result.hits.hits,border:"",stripe:"","highlight-current-row":"",fit:"",size:"mini"},on:{"row-click":t.showRowDialog,"sort-change":t.changeSort}},[s("el-table-column",{attrs:{type:"index",width:"50"}}),s("el-table-column",{attrs:{prop:"_id",label:"_id","show-overflow-tooltip":!0}}),s("el-table-column",{attrs:{prop:"_score",label:"_score","show-overflow-tooltip":!0}}),s("el-table-column",{attrs:{prop:"_type",label:"_type","show-overflow-tooltip":!0}}),t.tabs.index.result.hits.hits&&t.tabs.index.result.hits.hits.length>0?t._l(t.tabs.index.result.hits.hits[0]._source,(function(t){return s("el-table-column",{key:t,attrs:{prop:"_source."+t,label:t,sortable:"","show-overflow-tooltip":!0}})})):t._e()],2)],1)],1),s("el-tab-pane",{attrs:{name:"query",label:"DSL 快速查询"}},[s("el-row",[s("el-col",{attrs:{span:6}},[s("el-button-group",{staticClass:"margin-bottom "},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.dslSearch}},[t._v("搜索")])],1),s("vue-json-editor",{attrs:{mode:"code","expanded-on-start":!0,"show-btns":!1,lang:"zh"},model:{value:t.tabs.query.input.dsl,callback:function(e){t.$set(t.tabs.query.input,"dsl",e)},expression:"tabs.query.input.dsl"}})],1),s("el-col",{attrs:{span:18}},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tabs.query.result.hits.hits,border:"",stripe:"","highlight-current-row":"",fit:"",size:"mini"},on:{"row-click":t.showRowDialog,"sort-change":t.changeSort}},[s("el-table-column",{attrs:{type:"index",width:"50"}}),s("el-table-column",{attrs:{prop:"_id",label:"_id","show-overflow-tooltip":!0}}),s("el-table-column",{attrs:{prop:"_score",label:"_score","show-overflow-tooltip":!0}}),s("el-table-column",{attrs:{prop:"_type",label:"_type","show-overflow-tooltip":!0}}),t.tabs.query.result.hits.hits&&t.tabs.query.result.hits.hits.length>0?t._l(t.tabs.query.result.hits.hits[0]._source,(function(t){return s("el-table-column",{key:t,attrs:{prop:"_source."+t,label:t,sortable:"","show-overflow-tooltip":!0}})})):t._e()],2)],1)],1)],1)],1),s("el-dialog",{attrs:{visible:t.indexDataDialog.show,title:"数据展示"},on:{"update:visible":function(e){return t.$set(t.indexDataDialog,"show",e)}}},[s("vue-json-editor",{attrs:{"expanded-on-start":!0,"show-btns":!1,lang:"zh"},model:{value:t.indexDataDialog.json,callback:function(e){t.$set(t.indexDataDialog,"json",e)},expression:"indexDataDialog.json"}})],1)],1)},n=[],l=(s("ac1f"),s("1276"),s("4e82"),s("b0c0"),s("841c"),s("b680"),s("b1a9")),r=(s("99af"),s("b775")),o={clusterHealth:function(t){return r["a"].get("/elasticsearch/cluster/health",{params:{connName:t}})},clusterState:function(t){return r["a"].get("/elasticsearch/cluster/state",{params:{connName:t}})},clusterNodes:function(t){return r["a"].get("/elasticsearch/cluster/nodes",{params:{connName:t}})},nodeStats:function(t){return r["a"].get("/elasticsearch/node/stats",{params:{connName:t}})},status:function(t){return r["a"].get("/elasticsearch/status",{params:{connName:t}})},search:function(t,e,s){return r["a"].post("/elasticsearch/search/".concat(t,"/").concat(e),s,r["b"].json)},dslSearch:function(t,e){return r["a"].post("/elasticsearch/search/".concat(t),e,r["b"].json)}},i=s("45a3"),c=s("ed08"),d={query:{bool:{must:[],must_not:[],should:[{match_all:{}}]}},from:0,size:50,sort:[{_score:{order:"desc"}}],aggs:{},version:!0},u={query:{match_all:{}}},h={name:"Elasticsearch",components:{vueJsonEditor:i["a"]},data:function(){return{input:{connect:null},connects:[],clusterModel:{clusterHealth:{},clusterState:{},clusterNodes:{},nodeStats:{},status:{}},tabs:{activeTabName:"index",index:{input:{dsl:d,indexName:null},shardAlloc:[],settings:{},mappings:{},result:{_shards:{},hits:{hits:[]},took:null,timed_out:null}},query:{input:{dsl:u},result:{hits:{hits:[]}}}},indexDataDialog:{show:!1,json:{}}}},computed:{indices:function(){var t=this.clusterModel.status.indices;if(t){var e=[];for(var s in t){var a=t[s].primaries;e.push({indexName:s,docs:a.docs,store:a.store.size_in_bytes})}return e}return[]},nodes:function(){if(this.clusterModel.clusterNodes){var t=this.clusterModel.clusterNodes.nodes,e=[];for(var s in t)e.push(Object.assign({id:s},t[s]));return e}return[]}},mounted:function(){this.refreshConnects()},methods:{parseTime:c["f"],formatSizeHuman:c["d"],closeNode:function(){},formatSize:function(t,e){},dslSearch:function(){var t=this;o.dslSearch(this.input.connect,this.tabs.index.input.dsl).then((function(e){t.tabs.query.result=e.data}))},handleSizeChange:function(t){this.tabs.index.input.dsl.size=t,this.searchIndexData()},handleCurrentChange:function(t){this.tabs.index.input.dsl.from=t,this.searchIndexData()},changeSort:function(t){var e=t.column,s=(t.prop,t.order),a={},n=e.property.split(".")[1];a[n]="ascending"===s?{order:"asc"}:{order:"desc"};var l=[{_score:{order:"desc"}}];l.push(a),this.tabs.index.input.dsl.sort=l,this.searchIndexData()},showRowDialog:function(t,e,s){this.indexDataDialog.show=!0,this.indexDataDialog.json=t},refreshConnects:function(){var t=this;l["a"].security.moduleConnectNames("elasticsearch").then((function(e){t.connects=e.data,e.data&&e.data.length>0&&(t.input.connect=e.data[0],t.choseConnect(e.data[0]))}))},choseConnect:function(t){var e=this;o.clusterHealth(t).then((function(t){e.clusterModel.clusterHealth=t.data})),o.clusterNodes(t).then((function(t){e.clusterModel.clusterNodes=t.data})),o.nodeStats(t).then((function(t){e.clusterModel.nodeStats=t.data})),o.clusterState(t).then((function(t){e.clusterModel.clusterState=t.data})),o.status(t).then((function(t){e.clusterModel.status=t.data}))},switchTab:function(t,e){switch(t.name){case"dashboard":break;case"index":break}},searchIndexDataEvent:function(t){this.tabs.index.input.indexName=t.indexName;var e=this.clusterModel.clusterState.routing_table.indices[t.indexName].shards,s={};for(var a in e)for(var n=e[a],l=0;l<n.length;l++){var r=this.clusterModel.clusterNodes.nodes[n[l].node];s[r.host]=s[r.host]||[],s[r.host].push(n[l])}var o=[];for(var i in s)o.push({host:i,shards:s[i]});this.tabs.index.shardAlloc=o;var c=this.clusterModel.clusterState.metadata;this.tabs.index.settings=c.indices[t.indexName].settings,this.tabs.index.mappings=c.indices[t.indexName].mappings,this.searchIndexData()},searchIndexData:function(){var t=this;o.search(this.input.connect,this.tabs.index.input.indexName,this.tabs.index.input.dsl).then((function(e){t.tabs.index.result=e.data}))},calcStorageUsePercent:function(t){var e=this.clusterModel.nodeStats.nodes[t.id].fs.data[0],s=(e.total_in_bytes-e.available_in_bytes)/e.total_in_bytes;return s.toFixed(2)},calcJvmMemUsePercent:function(t){var e=this.clusterModel.nodeStats.nodes[t.id].jvm.mem;return e.heap_used_percent},calcHttpOpen:function(t){var e=this.clusterModel.nodeStats.nodes[t.id].http;return e.current_open}}},p=h,b=(s("97fb"),s("2877")),m=Object(b["a"])(p,a,n,!1,null,"b3ff001a",null);e["default"]=m.exports},"97fb":function(t,e,s){"use strict";s("2250")}}]);